<!DOCTYPE html>

<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Utils</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>


<body>

<div style="display: flex; flex-direction: row; ">
    <div style="margin: 20px">
        <label for="input_binary">Enter Binary</label>
        <br>
        <input placeholder="Binary" id="input_binary" oninput="calculate(this.id)">

    </div>

    <div style="margin: 20px">
        <label for="input_decimal">Enter Decimal</label>
        <br>
        <input placeholder="Decimal" id="input_decimal" oninput="calculate(this.id)">
    </div>

    <div style="margin: 20px">
        <label for="input_hex">Enter Hex</label>
        <br>
        <input placeholder="Hex" id="input_hex" oninput="calculate(this.id)">
    </div>

    <div style="margin: 20px">
        <label for="input_octal">Enter Octal</label>
        <br>
        <input placeholder="Octal" id="input_octal" oninput="calculate(this.id)">
    </div>

</div>



<h2>Result in:</h2>

<br>
<span>Decimal: </span>
<code id="res_decimal" onclick="window.getSelection().selectAllChildren(this)"></code>

<br><br>
<span>Binary: </span>
<code id="res_binary" onclick="window.getSelection().selectAllChildren(this)"></code>

<br><br>
<span>Hex: </span>
<code id="res_hex" onclick="window.getSelection().selectAllChildren(this)"></code>

<br><br>
<span>Octal: </span>
<code id="res_octal" onclick="window.getSelection().selectAllChildren(this)"></code>
<br>

</body>
</html>

<script>

    test()


    function test() {
        const start = Date.now()

        for (let k = 1; k < 1000; k++) {
            const i = Math.floor(Math.random()*1000000)
            const binary = decimalToBinary(i, 0)
            const hex = binaryToHex(binary)
            const octal = binaryToOctal(binary)
            const decimal = binaryToDecimal(binary)

            console.assert(i === parseInt(binary, 2), binary)
            console.assert(i === parseInt(hex, 16), binary)
            console.assert(i === parseInt(octal, 8), binary)
            console.assert(i === decimal, binary)
            console.assert(i === binaryToDecimal(hexToBinary(hex)), binary)
            console.assert(i === binaryToDecimal(octalToBinary(octal)), binary)
        }
        console.log("Tests passed in " + (Date.now()-start) + "ms")
    }

    function calculate(id) {
        let binary = calculateBinary(id)

        for (const e of document.getElementsByTagName("input")) {
            e.style.backgroundColor = "white"
        }
        document.getElementById(id).style.backgroundColor = binary === "?" ? "#ff9999" : "#92ea92"

        document.getElementById("res_decimal").innerText = String(binaryToDecimal(binary) === 0 ? "" : binaryToDecimal(binary))
        document.getElementById("res_binary").innerText = decimalToBinary(binaryToDecimal(binary), 0)
        document.getElementById("res_hex").innerText = binaryToHex(binary)
        document.getElementById("res_octal").innerText = binaryToOctal(binary)
    }

    function calculateBinary(input_id) {
        let text = document.getElementById(input_id).value;

        switch (input_id) {
            case "input_binary": return decimalToBinary(binaryToDecimal(text), 0); // validate it
            case "input_decimal": return decimalToBinary(text, 0)
            case "input_hex": return hexToBinary(text)
            case "input_octal": return octalToBinary(text) // todo
            default: throw Error("Bad base!")
        }
    } // todo visualise twos complement too

    function binaryToDecimal(binary) {
        if (typeof binary !== "string") return "?"

        binary = binary.trim().replaceAll(" ", "")
        let res = 0;

        for (let i = 0; i < binary.length; i++) {
            const char = binary[binary.length-i-1]
            if (char === '1') {
                res += Math.pow(2, i)
                continue;
            }

            if (char !== '0') return "?"
        }

        return res
    }

    function decimalToBinary(decimal, numCharsToPad) {
        if (typeof decimal !== "number") decimal = parseInt(decimal)
        if (isNaN(decimal)) return "?"

        let res = ""

        while (decimal > 0) {
            res= (decimal % 2 === 0 ? '0' : '1') + res
            decimal >>= 1
        }
        return res.padStart(numCharsToPad, '0')
    }

    function hexToBinary(hex) {
        if (typeof hex !== "string") return "?"
        hex = hex.trim().replaceAll(" ", "")

        let res = ""

        for (let i = 0; i < hex.length; i++) {
            const char = hex[i].toUpperCase().charCodeAt(0)
            if (char < 48 || char > 70 || (char >= 58 && char <= 64)) return "?" // 0-9, a-f

            const decimal = char <= 57 ? char - 48 : char - 55
            let binary = decimalToBinary(decimal, 4);

            res+= binary
        }
        return res
    }


    function octalToBinary(octal) {
        if (typeof octal !== "string") return "?"
        octal = octal.trim().replaceAll(" ", "")

        let res = ""

        for (let i = 0; i < octal.length; i++) {
            const char = octal[i].toUpperCase().charCodeAt(0)
            if (char < 48 || char > 55) return "?" // 0-7

            const decimal = char-48;
            let binary = decimalToBinary(decimal, 3);

            res+= binary
        }
        return res
    }

    function binaryToHex(binary) {
        if (typeof binary !== "string") return "?"

        binary = binary.trim().replaceAll(" ", "")
        let res = ""

        for (let i = 0; i+3 < binary.length; i+=4) {
            const slice = binary.substring(binary.length-i-4, binary.length-i)
            const decimal = binaryToDecimal(slice)
            if (decimal === "?") return "?"
            const hexCode = decimal <= 9 ? String.fromCharCode(48+decimal) : String.fromCharCode(65+decimal-10)

            res = hexCode + res;
        }
        if (binary.length % 4 === 0) return res

        const remainingSlice = binary.substring(0, binary.length%4)

        const decimal = binaryToDecimal(remainingSlice)
        if (decimal === "?") return "?"
        const hexCode = decimal <= 9 ? String.fromCharCode(48+decimal) : String.fromCharCode(65+decimal-10)

        res = hexCode + res;

        return res
    }

    function binaryToOctal(binary) {
        if (typeof binary !== "string") return "?"

        binary = binary.trim().replaceAll(" ", "")
        let res = ""

        for (let i = 0; i+2 < binary.length; i+=3) {
            const slice = binary.substring(binary.length-i-3, binary.length-i)
            const decimal = binaryToDecimal(slice)
            if (decimal === "?") return "?"
            const octal = String.fromCharCode(48+decimal)

            res = octal + res;
        }
        if (binary.length % 3 === 0) return res

        const remainingSlice = binary.substring(0, binary.length%3)

        const decimal = binaryToDecimal(remainingSlice)
        if (decimal === "?") return "?"
        const octal = String.fromCharCode(48+decimal)

        res = octal + res;

        return res
    }

</script>


<style>

    html {
        margin: 20px;
    }


</style>